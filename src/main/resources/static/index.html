<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GrappleLogic Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #e0e0e0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .game-container { background: #1e1e1e; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 450px; border: 1px solid #333; }
        .status-panel { background: #252525; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #e67e22; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { background: #34495e; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: bold; }
        button:hover { background: #e67e22; transform: translateY(-2px); }
        #log { margin-top: 1.5rem; height: 120px; overflow-y: auto; background: #000; padding: 10px; font-family: 'Courier New', monospace; font-size: 0.9rem; border-radius: 4px; color: #2ecc71; text-align: left; }
        .stat-line { color: #aaa; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="game-container">
    <h2>GrappleLogic v1.0</h2>
    <div class="stat-line">Match: BJJ (Attacker) vs WRESTLER (Defender)</div>

    <div class="status-panel">
        <strong>Current Position:</strong> <span id="pos-display">STANDING</span>
    </div>

    <div class="controls">
        <button onclick="executeMove('DOUBLE_LEG')">Double Leg</button>
        <button onclick="executeMove('PULL_GUARD')">Pull Guard</button>
        <button onclick="executeMove('BACK_TAKE')">Take Back</button>
        <button onclick="executeMove('REAR_NAKED_CHOKE')">RNC Finish</button>
    </div>

    <div id="log">>> Ready for combat...</div>
</div>

<script>

    let currentPos = "STANDING";

    async function executeMove(moveName) {
        const logElement = document.getElementById('log');

        const requestData = {
            attacker: "BJJ",
            defender: "WRESTLER",
            move: moveName,
            currentPosition: currentPos
        };

        try {
            const response = await fetch('/api/v1/match/resolve', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) throw new Error('Server Error (Check your Enum names!)');

            const result = await response.json();

            // Update UI based on the TurnResult DTO
            logElement.innerHTML += `<div>> ${result.actionLog}</div>`;
            logElement.scrollTop = logElement.scrollHeight;

            if (result.success) {
                currentPos = result.newPosition;
                document.getElementById('pos-display').innerText = currentPos;
            }

            if (result.isGameOver) {
                logElement.innerHTML += `<div style="color: gold;">*** MATCH OVER - SUBMISSION! ***</div>`;
            }

        } catch (error) {
            logElement.innerHTML += `<div style="color: #e74c3c;">! Error: ${error.message}</div>`;
        }
    }

</script>
</body>
</html>